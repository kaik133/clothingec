<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品管理 - 管理画面</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a th:href="@{/home}" class="logo">Clothing EC - 管理画面</a>
            <ul class="nav-menu">
                <li><a th:href="@{/admin/dashboard}">ダッシュボード</a></li>
                <li><a th:href="@{/admin/products}" class="active">商品管理</a></li>
                <li><a th:href="@{/admin/users}">ユーザー管理</a></li>
                <li><a th:href="@{/home}">サイトに戻る</a></li>
                <li>
                    <span sec:authentication="name">ユーザー</span>
                </li>
                <li>
                    <form th:action="@{/logout}" method="post" style="display:inline;">
                        <button type="submit" class="btn-logout">ログアウト</button>
                    </form>
                </li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <div class="admin-header">
            <h1>商品管理</h1>
            <a th:href="@{/admin/products/new}" class="btn btn-primary">➕ 新規商品登録</a>
        </div>
        
        <div class="admin-table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>画像</th>
                        <th>商品名</th>
                        <th>カテゴリー</th>
                        <th>価格</th>
                        <th>在庫</th>
                        <th>ステータス</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.id}">1</td>
                        <td>
                            <img th:src="${product.imageUrl}" 
                                 th:alt="${product.name}"
                                 class="admin-product-img"
                                 onerror="this.src='https://via.placeholder.com/50x50?text=No+Image'">
                        </td>
                        <td th:text="${product.name}">Product Name</td>
                        <td th:text="${product.category}">Category</td>
                        <td th:text="${'¥' + #numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')}">¥0</td>
                        <td th:text="${product.stockQuantity}">0</td>
                        <td>
                            <span th:class="'status-badge ' + ${product.status.name()}"
                                  th:text="${product.status.name() == 'ACTIVE' ? '販売中' : 
                                           (product.status.name() == 'INACTIVE' ? '非公開' : '在庫切れ')}">
                                Status
                            </span>
                        </td>
                        <td class="admin-actions">
                            <a th:href="@{/admin/products/edit/{id}(id=${product.id})}" 
                               class="btn-small btn-edit">編集</a>
                            
                            <form th:action="@{/admin/products/status/{id}(id=${product.id})}" 
                                  method="post" style="display:inline;">
                                <select name="status" onchange="this.form.submit()" class="status-select">
                                    <option value="ACTIVE" th:selected="${product.status.name() == 'ACTIVE'}">販売中</option>
                                    <option value="INACTIVE" th:selected="${product.status.name() == 'INACTIVE'}">非公開</option>
                                    <option value="OUT_OF_STOCK" th:selected="${product.status.name() == 'OUT_OF_STOCK'}">在庫切れ</option>
                                </select>
                            </form>
                            
                            <form th:action="@{/admin/products/delete/{id}(id=${product.id})}" 
                                  method="post" style="display:inline;"
                                  onsubmit="return confirm('本当に削除しますか？');">
                                <button type="submit" class="btn-small btn-delete">削除</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div th:if="${#lists.isEmpty(products)}" class="no-data">
                <p>登録されている商品がありません</p>
                <a th:href="@{/admin/products/new}" class="btn btn-primary">最初の商品を登録する</a>
            </div>
        </div>
    </div>
    
    <footer style="margin-top: 4rem; background-color: #2c3e50; color: white; text-align: center; padding: 2rem 0;">
        <div class="container">
            <p>&copy; 2025 Clothing EC 管理システム. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
</body>
</html>